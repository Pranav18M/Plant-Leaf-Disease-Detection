"""
Installation Verification Script
Checks if all dependencies are properly installed
"""

import sys
import importlib

def check_python_version():
    """Check Python version"""
    version = sys.version_info
    print(f"Python version: {version.major}.{version.minor}.{version.micro}")
    
    if version.major == 3 and version.minor >= 8:
        print("✓ Python version compatible (3.8+)")
        return True
    else:
        print("✗ Python 3.8+ required")
        return False


def check_package(package_name, import_name=None):
    """Check if a package is installed"""
    if import_name is None:
        import_name = package_name
    
    try:
        module = importlib.import_module(import_name)
        version = getattr(module, '__version__', 'unknown')
        print(f"✓ {package_name}: {version}")
        return True
    except ImportError:
        print(f"✗ {package_name}: NOT INSTALLED")
        return False


def check_tamil_font():
    """Check if Tamil font is available"""
    import os
    font_path = os.path.join('..', 'font', 'NotoSansTamil-Regular.ttf')
    
    if os.path.exists(font_path):
        print(f"✓ Tamil font found: {font_path}")
        return True
    else:
        print(f"✗ Tamil font not found at: {font_path}")
        return False


def check_directories():
    """Check if required directories exist"""
    import os
    
    dirs = ['../data', '../models', '../font']
    all_exist = True
    
    for dir_path in dirs:
        if os.path.exists(dir_path):
            print(f"✓ Directory exists: {dir_path}")
        else:
            print(f"✗ Directory missing: {dir_path}")
            all_exist = False
    
    return all_exist


def main():
    print("="*70)
    print("Plant Disease Detection System - Installation Verification")
    print("="*70)
    print()
    
    checks = []
    
    # Check Python version
    print("[1] Checking Python Version...")
    checks.append(check_python_version())
    print()
    
    # Check core packages
    print("[2] Checking Core Packages...")
    packages = [
        ('numpy', 'numpy'),
        ('scikit-learn', 'sklearn'),
        ('scikit-image', 'skimage'),
        ('opencv-python', 'cv2'),
        ('Pillow', 'PIL'),
        ('matplotlib', 'matplotlib'),
        ('joblib', 'joblib'),
    ]
    
    for pkg_name, import_name in packages:
        checks.append(check_package(pkg_name, import_name))
    print()
    
    # Check optional packages
    print("[3] Checking Optional Packages...")
    optional_packages = [
        ('pandas', 'pandas'),
        ('tqdm', 'tqdm'),
        ('imgaug', 'imgaug'),
    ]
    
    for pkg_name, import_name in optional_packages:
        check_package(pkg_name, import_name)
    print()
    
    # Check directories
    print("[4] Checking Project Structure...")
    checks.append(check_directories())
    print()
    
    # Check Tamil font
    print("[5] Checking Tamil Font...")
    checks.append(check_tamil_font())
    print()
    
    # Summary
    print("="*70)
    passed = sum(checks)
    total = len(checks)
    
    if passed == total:
        print(f"✓ ALL CHECKS PASSED ({passed}/{total})")
        print("✓ System is ready for use!")
    else:
        print(f"✗ SOME CHECKS FAILED ({passed}/{total} passed)")
        print("✗ Please fix the issues above before running the system.")
    
    print("="*70)
    
    return passed == total


if __name__ == "__main__":
    success = main()
    sys.exit(0 if success else 1)
